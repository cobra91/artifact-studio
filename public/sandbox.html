<!doctype html>
<html>
  <head>
    <title>Sandbox</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/svelte/compiler.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/javascript">
      const renderers = {
        react: (code) => {
          const transformedCode = Babel.transform(code, { presets: ["react"] }).code;
          const Component = new Function("React", "useState", "useEffect", `return ${transformedCode}`)(React, React.useState, React.useEffect);
          const root = ReactDOM.createRoot(document.getElementById("root"));
          root.render(<Component />);
        },
        vue: (code) => {
          const { createApp } = Vue;
          const template = code.match(/<template>([\s\S]*)<\/template>/)[1];
          const scriptContent = code.match(/<script.*>([\s\S]*)<\/script>/)[1];
          const app = createApp({
            template,
            setup() {
              const { ref, onMounted } = Vue;
              let setupCode = new Function('ref', 'onMounted', scriptContent);
              return setupCode(ref, onMounted);
            }
          });
          app.mount("#root");
        },
        svelte: (code) => {
          const { code: jsCode } = svelte.compile(code);
          const Component = new Function(jsCode + "\nreturn Component;")();
          new Component({ target: document.getElementById("root") });
        },
      };

      window.addEventListener("message", (event) => {
        const { type, payload } = event.data;
        if (type === "render-component") {
          try {
            const { framework, code } = payload;
            if (renderers[framework]) {
              renderers[framework](code);
              window.parent.postMessage({ type: "render-component", payload: { success: true } }, "*");
            } else {
              throw new Error(`Unsupported framework: ${framework}`);
            }
          } catch (error) {
            console.error("Error rendering component:", error);
            window.parent.postMessage({ type: "error", payload: { error: error.message } }, "*");
          }
        }
      });

      // Notify the parent window that the sandbox is ready
      window.parent.postMessage({ type: "sandbox-ready" }, "*");
    </script>
  </body>
</html>
